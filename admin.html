<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Admin Panel - Game Toán Học</title>
    <style>
        body { font-family: sans-serif; background-color: #282c34; color: white; padding: 20px; }
        .container { display: flex; gap: 30px; }
        .user-panel, .detail-panel { flex: 1; }
        #login-section, #admin-panel { padding: 20px; border: 1px solid #61dafb; border-radius: 8px; }
        #admin-panel { display: none; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #444; padding: 10px; text-align: left; }
        th { background-color: #20232a; }
        button { font-size: 14px; padding: 5px 10px; margin-right: 5px; cursor: pointer; }
        .btn-delete { background-color: #e74c3c; color: white; border: none; }
        .btn-edit { background-color: #f1c40f; color: black; border: none; }
        .btn-view { background-color: #3498db; color: white; border: none; }
        input { padding: 8px; font-size: 16px; margin-bottom: 10px; }
    </style>
</head>
<body>
    <h1>Trang Quản Trị</h1>
    <p>Trạng thái kết nối: <b id="status" style="color: red;">Đang kết nối...</b></p>

    <div id="login-section">
        <h3>Đăng nhập Admin</h3>
        <input type="password" id="adminPassword" placeholder="Nhập mật khẩu">
        <button id="loginBtn">Đăng nhập</button>
    </div>

    <div id="admin-panel">
        <div class="container">
            <div class="user-panel">
                <h2>Danh sách người chơi</h2>
                <button id="refreshUsersBtn">Làm mới danh sách</button>
                <table id="user-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Tên người chơi</th>
                            <th>Avatar ID</th>
                            <th>Hành động</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div class="detail-panel">
                <h2>Chi tiết Lịch sử chơi</h2>
                <p id="currentUser">Chọn một người dùng để xem lịch sử.</p>
                <div id="history-data"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        const socket = io('https://mathhandventures.onrender.com'); 
        
        const statusEl = document.getElementById('status');
        const loginSection = document.getElementById('login-section');
        const adminPanel = document.getElementById('admin-panel');
        const loginBtn = document.getElementById('loginBtn');
        const adminPasswordInput = document.getElementById('adminPassword');
        const userTableBody = document.querySelector('#user-table tbody');
        const refreshUsersBtn = document.getElementById('refreshUsersBtn');
        const currentUserEl = document.getElementById('currentUser');
        const historyDataEl = document.getElementById('history-data');

        // --- LẮNG NGHE SỰ KIỆN TỪ SERVER ---
        socket.on('connect', () => { statusEl.textContent = 'Đã kết nối!'; statusEl.style.color = 'lime'; });
        socket.on('admin_login_success', () => { loginSection.style.display = 'none'; adminPanel.style.display = 'block'; refreshUsersBtn.click(); });
        socket.on('admin_login_fail', () => { alert('Sai mật khẩu!'); });

        socket.on('admin_user_list